{
  "version": 3,
  "sources": ["../../site/src/main.ts", "../../site/src/examples.ts"],
  "sourcesContent": ["import init, { run } from \"./csl_web.js\";\nimport { examples } from \"./examples.js\";\n\n/** Assume $ always succeeds and returns an HTMLElement */\nfunction $<MatchType extends HTMLElement>(selector: string) {\n  return document.querySelector(selector) as MatchType;\n}\n\nlet wasmReady = false;\n\nconst form = $<HTMLFormElement>(\"form\");\nform.onsubmit = () => {\n  if (!wasmReady) {\n    alert(\"Wasm module not yet loaded\");\n    return;\n  }\n  const src = srcInput.value;\n  let output;\n  try {\n    output = run(src);\n  } catch (e) {\n    output = `Unexpected: ${e}`;\n    console.error(e);\n  }\n  const outElem = $<HTMLTextAreaElement>(\"pre#output\");\n  outElem.innerText = output;\n};\n\nfunction debounce<T extends Function>(cb: T, timeout = 20) {\n  let tm = 0;\n  const debounced = (...args: any) => {\n    clearTimeout(tm);\n    tm = setTimeout(() => cb(...args), timeout);\n  };\n  Object.defineProperty(debounced, \"name\", { value: `debounced_${cb.name}` });\n  return debounced as any as T;\n}\n\nfunction saveToLocalStorage() {\n  localStorage.setItem(\"saved-src\", srcInput.value);\n}\n\nconst srcInput = $<HTMLTextAreaElement>(\"textarea#src\");\n\nconst saved = localStorage.getItem(\"saved-src\");\nif (saved === null || /^\\s+$/.test(saved)) {\n  srcInput.value = examples[0].source;\n} else {\n  srcInput.value = saved;\n}\n\nconst examplesSpan = $<HTMLSpanElement>(\"#examples\");\nfor (const example of examples) {\n  const btn = document.createElement(\"button\");\n  btn.innerText = example.name;\n  btn.addEventListener(\"click\", () => {\n    srcInput.value = example.source;\n    saveToLocalStorage();\n  });\n  examplesSpan.appendChild(btn);\n  examplesSpan.appendChild(document.createTextNode(\" \"));\n}\n\nsrcInput.addEventListener(\"input\", debounce(saveToLocalStorage, 500), false);\n\ninit().then(() => {\n  wasmReady = true;\n});\n", "interface Example {\n  name: string;\n  source: string;\n}\n\nconst _examples: Example[] = [\n  {\n    name: \"i64 add\",\n    source: `fn add(x: i64, y: i64) -> i64 {\n      ret x + y;\n    }\n\n    fn main() -> i64 {\n      ret add(1, 2) * 3;\n    }`,\n  },\n  {\n    name: \"f64 add\",\n    source: `fn add(x: f64, y: f64) -> f64 {\n      ret x + y;\n    }\n\n    fn main() -> f64 {\n      ret add(1.0, 2.0) * 3.5;\n    }`,\n  },\n  {\n    name: \"let binding\",\n    source: `fn sum_square(x: f64, y: f64) -> f64 {\n      let xx = x * x;\n      let yy = y * y;\n      ret xx + yy;\n    }\n\n    fn main() -> f64 {\n      ret sum_square(3.0, 4.0);\n    }`,\n  },\n  {\n    name: \"nested block\",\n    source: `fn funny_polynomial(x: f64) -> f64 {\n      let y = {\n        let a = x * x;\n        ret a * a + a + 1.0;\n      };\n      let z = {\n        let a = x - 1.0;\n        ret a * a - a - 1.0;\n      };\n      ret y + z;\n    }\n    fn main() -> f64 {\n      ret funny_polynomial(2.0);\n    }`,\n  },\n  {\n    name: \"fibonacci (slow)\",\n    source: `fn fib(n: i64) -> i64 {\n      ret if (n == 0) 0\n          else if (n == 1) 1\n          else fib(n-1) + fib(n-2);\n    }\n    fn main() -> i64 {\n      ret fib(12);\n    }`,\n  },\n  {\n    name: \"fibonacci (fast)\",\n    source: `fn f(x: i64, y: i64, n: i64) -> i64 {\n      ret if (n == 0) y\n          else f(y+x, x, n-1);\n    }\n    fn fib(n: i64) -> i64 {\n      ret f(1,0,n);\n    }\n    fn main() -> i64 { ret fib(50); }`,\n  },\n];\n\nexport const examples: Example[] = _examples.map((ex) => ({\n  ...ex,\n  source: dedent(ex.source),\n}));\n\nfunction dedent(s: string): string {\n  const lines = s.split(\"\\n\");\n  if (lines.length <= 1) return s;\n  let commonWS = leadingWhitespace(lines[1]);\n  for (const line of lines.slice(2)) {\n    if (/^\\s*$/.test(line)) {\n      // Fully blank line; skip\n      continue;\n    }\n    const ws = leadingWhitespace(line);\n    commonWS = commonPrefix(commonWS, ws);\n    if (commonWS.length === 0) return s;\n  }\n  if (commonWS.length === 0) return s;\n  const wsLen = commonWS.length;\n  let ret = lines[0];\n  for (const line of lines.slice(1)) {\n    ret += \"\\n\" + line.slice(wsLen);\n  }\n  return ret;\n}\n\nfunction leadingWhitespace(line: string): string {\n  return line.match(/^\\s*/)?.[0] ?? \"\";\n}\n\nfunction commonPrefix(a: string, b: string) {\n  const m = Math.min(a.length, b.length);\n  for (let i = 0; i < m; i++) {\n    if (a[i] !== b[i]) return a.slice(0, i);\n  }\n  return a.slice(0, m);\n}\n"],
  "mappings": "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",
  "names": []
}
